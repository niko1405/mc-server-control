<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minecraft Server Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #1b1b2f;
        color: #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 2rem;
    }

    h1 {
        color: #ffcc00;
        margin-bottom: 2rem;
        text-align: center;
    }

    .status-box {
        border-radius: 12px;
        padding: 1.2rem 2rem;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
        min-width: 300px;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        transition: 0.3s;
    }
    .running { background: #28a745; color: #fff; }
    .stopped { background: #dc3545; color: #fff; }
    .starting, .stopping { background: #ffc107; color: #000; }

    .controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .buttons {
        display: flex;
        gap: 1rem;
    }

    button {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: 0.2s;
    }

    button:hover { background: #0056b3; }

    input[type="password"] {
        padding: 0.6rem 1rem;
        font-size: 1rem;
        border-radius: 8px;
        border: none;
        width: 200px;
        text-align: center;
    }

    .log {
        width: 100%;
        max-width: 600px;
        background: #2c2c3f;
        padding: 1rem;
        border-radius: 12px;
        min-height: 150px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.9rem;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    /* Dialog-Fenster */
    .dialog-backdrop {
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.5);
        display:none;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }
    .dialog {
        background: #1b1b2f;
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 0 20px rgba(0,0,0,0.7);
        max-width: 400px;
        width: 90%;
    }
    .dialog button {
        margin-top: 1rem;
        background: #ffcc00;
        color: #000;
        font-weight: bold;
    }

</style>
</head>
<body>

<h1><i class="fas fa-cubes"></i> Minecraft Server Dashboard</h1>

<div id="statusBox" class="status-box stopped">
    <i class="fas fa-circle-notch fa-spin" id="statusIcon"></i>
    <span id="statusText">Lade Status...</span>
</div>

<div class="controls">
    <input type="password" id="passwordInput" placeholder="Passwort eingeben" />
    <div class="buttons">
        <button onclick="confirmAction('start')"><i class="fas fa-play"></i> Start</button>
        <button onclick="confirmAction('stop')"><i class="fas fa-stop"></i> Stop</button>
    </div>
</div>

<div class="log" id="logBox">
    -- Server-Log --
</div>

<!-- Dialog -->
<div id="dialogBackdrop" class="dialog-backdrop">
    <div class="dialog">
        <div id="dialogMessage"></div>
        <button onclick="closeDialog()">OK</button>
    </div>
</div>

<script>
const BaseURL = "https://mc-server-func-fsg8bvbfh2fyaec8.norwayeast-01.azurewebsites.net/api/mc-server-func";

const statusBox = document.getElementById('statusBox');
const statusText = document.getElementById('statusText');
const statusIcon = document.getElementById('statusIcon');
const logBox = document.getElementById('logBox');
const dialogBackdrop = document.getElementById('dialogBackdrop');
const dialogMessage = document.getElementById('dialogMessage');
const passwordInput = document.getElementById('passwordInput');

// Status aktualisieren
async function updateStatus(showLoading = true){
    if(showLoading){
        statusText.textContent = "Lade Status...";
        statusBox.className = "status-box";
        statusIcon.className = "fas fa-circle-notch fa-spin";
    }
    try {
        const res = await fetch(`${BaseURL}?action=status`);
        const data = await res.json();
        let statusClass = "stopped";
        let iconClass = "fas fa-times-circle";
        if(data.message === "running") { statusClass="running"; iconClass="fas fa-check-circle"; }
        else if(data.message === "stopped") { statusClass="stopped"; iconClass="fas fa-times-circle"; }
        statusBox.className = `status-box ${statusClass}`;
        statusText.textContent = data.message.toUpperCase();
        statusIcon.className = iconClass;
    } catch(err){
        statusBox.className = "status-box stopped";
        statusText.textContent = "FEHLER beim Status";
        statusIcon.className = "fas fa-exclamation-triangle";
        console.error(err);
    }
}

// Action mit Passwort senden
async function performAction(action){
    const pwd = passwordInput.value.trim();
    if(!pwd){
        showDialog("Bitte Passwort eingeben!");
        return;
    }

    const body = { action: action, password: pwd };
    log(`Sende Aktion: ${action}...`);
    try {
        const res = await fetch(BaseURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });
        const data = await res.json();
        log(data.message);
        showDialog(data.message);
        updateStatus(false);
    } catch(err){
        log("Fehler beim Senden der Aktion");
        showDialog("Fehler beim Senden der Aktion");
        console.error(err);
    }
}

// Dialog-Fenster
function showDialog(msg){
    dialogMessage.textContent = msg;
    dialogBackdrop.style.display = "flex";
}
function closeDialog(){
    dialogBackdrop.style.display = "none";
}

// Confirmation Dialog vor Start/Stop
function confirmAction(action){
    showDialog(`Willst du wirklich '${action.toUpperCase()}' ausfÃ¼hren?`);
    const btn = dialogBackdrop.querySelector('button');
    btn.onclick = () => {
        closeDialog();
        performAction(action);
    };
}

// Log schreiben
function log(msg){
    const now = new Date().toLocaleTimeString();
    logBox.textContent += `[${now}] ${msg}\n`;
    logBox.scrollTop = logBox.scrollHeight;
}

// Status beim Laden
updateStatus();

// Optional: leichtes Polling alle 30 Sekunden
setInterval(() => updateStatus(false), 30000);
</script>

</body>
</html>
